<div class="box is-fullwidth is-bottomless is-sideless">
  <MessageError @model={{model}} />
  <div class="control-group-header {{if isSuccess 'is-success'}}">
    <p>
      <ICon @glyph={{if isSuccess "checkmark-circled" "control-lock"}} @size={{16}} />
      <strong data-test-banner-prefix>{{bannerPrefix}}</strong>
      {{bannerText}}
    </p>
  </div>
  <div class="control-group">
    {{#if model.requestEntity.canRead}}
      <a href={{href-to 'vault.cluster.access.identity.show' 'entities' model.requestEntity.id 'details'}}>
        {{requestorName}}
      </a>
    {{else}}
      {{requestorName}}
    {{/if}}
    {{#if currentUserIsRequesting}}are{{else}}is{{/if}}
    requesting access to <code>{{model.requestPath}}</code>

    <div class="authorizations">
      {{#if (gt model.authorizations.length 0)}}
      <span class="has-text-success">
        <ICon @glyph="checkmark-circled-outline" @size={{16}} />
      </span>
        Already approved by
        {{#each model.authorizations as |authorization|}}
          {{#if authorization.canRead}}
            <a href={{href-to 'vault.cluster.access.identity.show' 'entities' authorization.id 'details'}}>
              {{authorization.name}}
            </a>
          {{else}}
            {{authorization.name}}
          {{/if}}
        {{/each}}
      {{else}}
        Awaiting authorization.
      {{/if}}
    </div>
  </div>

    <div class="field is-grouped box is-fullwidth is-bottomless">
  {{#if model.canAuthorize}}
      {{#if (or model.approved currentUserHasAuthorized)}}

      <a href={{href-to 'vault.cluster.access.control-groups'}} class="button" >
        <ICon @glyph="chevron-left" @size=10 /> Back
        </a>
      {{else}}
        <button
          type="button"
          class="button is-primary {{if authorize.isRunning 'is-loading'}}"
          {{action (perform authorize)}}
          >
          Authorize
        </button>
      {{/if}}
    {{else}}

        <button
          type="button"
          class="button is-primary {{if refresh.isRunning 'is-loading'}}"
          {{action (perform refresh)}}
          >
          Refresh
        </button>
  {{/if}}
    </div>
</div>
